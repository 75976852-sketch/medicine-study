// 生成新的分类映射脚本
// 在浏览器控制台运行此脚本，它会输出新的medicineCategories对象

// 新的分类结构（扁平化，使用标准格式）
const newCategoryStructure = {
    "解表药-发散风寒": ["麻黄", "桂枝", "紫苏", "生姜", "香薷", "荆芥", "防风", "羌活", "白芷", "细辛", "藁本", "苍耳子", "辛夷"],
    "解表药-发散风热": ["薄荷", "牛蒡子", "桑叶", "蝉蜕", "菊花", "蔓荆子", "柴胡", "升麻", "葛根", "淡豆豉"],
    "清热药-清热泻火": ["石膏", "寒水石", "知母", "芦根", "天花粉", "淡竹叶", "栀子", "夏枯草", "决明子"],
    "清热药-清热燥湿": ["黄芩", "黄连", "黄柏", "龙胆", "苦参", "秦皮", "白鲜皮"],
    "清热药-清热解毒": ["金银花", "连翘", "穿心莲", "大青叶", "板蓝根", "青黛", "贯众", "蒲公英", "紫花地丁", "野菊花", "重楼", "漏芦", "土茯苓", "鱼腥草", "金荞麦", "大血藤", "败酱草", "射干", "山豆根", "马勃", "白头翁", "马齿苋", "鸦胆子", "地锦草", "半边莲", "白花蛇舌草", "山慈菇", "熊胆粉"],
    "清热药-清热凉血": ["生地黄", "玄参", "牡丹皮", "赤芍", "紫草", "水牛角"],
    "清热药-清虚热": ["青蒿", "白薇", "地骨皮", "银柴胡", "胡黄连"],
    "泻下药-攻下药": ["大黄", "芒硝", "番泻叶", "芦荟"],
    "泻下药-润下药": ["火麻仁", "郁李仁", "松子仁"],
    "泻下药-峻下逐水药": ["甘遂", "京大戟", "芫花", "牵牛子", "巴豆霜"],
    "祛风湿药-祛风寒湿药": ["独活", "威灵仙", "川乌", "蕲蛇", "乌梢蛇", "木瓜", "伸筋草", "海风藤", "青风藤", "路路通"],
    "祛风湿药-祛风湿热药": ["秦艽", "防己", "桑枝", "豨莶草", "臭梧桐叶", "海桐皮", "络石藤", "雷公藤"],
    "祛风湿药-祛风湿强筋骨药": ["五加皮", "桑寄生", "狗脊"],
    "化湿药": ["广藿香", "佩兰", "苍术", "厚朴", "砂仁", "豆蔻", "草豆蔻", "草果"],
    "利水渗湿药-利水消肿药": ["茯苓", "薏苡仁", "猪苓", "泽泻", "冬瓜皮", "玉米须", "香加皮"],
    "利水渗湿药-利尿通淋药": ["车前子", "滑石", "木通", "通草", "瞿麦", "萹蓄", "地肤子", "海金沙", "石韦", "萆薢"],
    "利水渗湿药-利湿退黄药": ["茵陈", "金钱草", "虎杖"],
    "温里药": ["附子", "干姜", "肉桂", "吴茱萸", "小茴香", "丁香", "高良姜", "花椒"],
    "理气药": ["陈皮", "青皮", "枳实", "木香", "沉香", "檀香", "川楝子", "乌药", "荔枝核", "香附", "佛手", "薤白", "大腹皮", "甘松", "刀豆", "柿蒂"],
    "消食药": ["山楂", "神曲", "麦芽", "稻芽", "莱菔子", "鸡内金"],
    "驱虫药": ["使君子", "苦楝皮", "槟榔", "鹤草芽", "雷丸", "榧子"],
    "止血药-凉血止血药": ["小蓟", "大蓟", "地榆", "槐花", "侧柏叶", "白茅根", "苎麻根"],
    "止血药-化瘀止血药": ["三七", "茜草", "蒲黄", "降香"],
    "止血药-收敛止血药": ["白及", "仙鹤草", "棕榈", "血余炭", "藕节"],
    "止血药-温经止血药": ["艾叶", "炮姜"],
    "活血化瘀药-活血止痛药": ["川芎", "延胡索", "郁金", "姜黄", "乳香", "没药", "五灵脂"],
    "活血化瘀药-活血调经药": ["丹参", "红花", "桃仁", "益母草", "泽兰", "牛膝", "鸡血藤", "王不留行"],
    "活血化瘀药-活血疗伤药": ["土鳖虫", "马钱子", "自然铜", "苏木", "骨碎补", "血竭"],
    "活血化瘀药-破血消癥药": ["莪术", "三棱", "水蛭", "穿山甲"],
    "化痰药-温化寒痰药": ["半夏", "天南星", "白附子", "白芥子", "皂荚", "旋覆花", "白前", "猫爪草"],
    "化痰药-清化热痰药": ["川贝母", "浙贝母", "瓜蒌", "竹茹", "竹沥", "天竺黄", "桔梗", "胖大海", "海藻", "昆布", "黄药子", "海蛤壳", "瓦楞子"],
    "止咳平喘药": ["苦杏仁", "紫苏子", "百部", "紫菀", "款冬花", "枇杷叶", "桑白皮", "葶苈子", "白果"],
    "安神药-重镇安神药": ["朱砂", "磁石", "龙骨", "琥珀"],
    "安神药-养心安神药": ["酸枣仁", "柏子仁", "远志", "合欢皮", "首乌藤", "灵芝"],
    "平肝熄风药-平抑肝阳药": ["石决明", "珍珠母", "牡蛎", "赭石", "蒺藜", "罗布麻叶"],
    "平肝熄风药-息风止痉药": ["羚羊角", "牛黄", "珍珠", "钩藤", "天麻", "地龙", "全蝎", "蜈蚣", "僵蚕"],
    "开窍药": ["麝香", "冰片", "苏合香", "石菖蒲"],
    "补虚药-补气": ["人参", "西洋参", "党参", "太子参", "黄芪", "白术", "山药", "白扁豆", "甘草", "大枣", "蜂蜜"],
    "补虚药-补阳": ["鹿茸", "淫羊藿", "巴戟天", "仙茅", "杜仲", "续断", "肉苁蓉", "锁阳", "补骨脂", "菟丝子", "益智", "沙苑子", "蛤蚧", "核桃仁", "冬虫夏草", "紫河车"],
    "补虚药-补血": ["当归", "熟地黄", "白芍", "阿胶", "何首乌", "龙眼肉"],
    "补虚药-补阴": ["北沙参", "南沙参", "百合", "麦冬", "天冬", "石斛", "玉竹", "黄精", "枸杞子", "墨旱莲", "女贞子", "楮实子", "龟甲", "鳖甲"],
    "收涩药-固表止汗药": ["麻黄根", "浮小麦", "糯稻根"],
    "收涩药-敛肺涩肠药": ["五味子", "乌梅", "五倍子", "诃子", "石榴皮", "肉豆蔻", "赤石脂", "禹余粮"],
    "收涩药-固精缩尿止带药": ["山茱萸", "桑螵蛸", "金樱子", "海螵蛸", "莲子", "芡实", "椿皮"],
    "涌吐药": ["常山", "藜芦"],
    "攻毒杀虫止痒药": ["硫黄", "雄黄", "白矾", "蛇床子", "土荆皮", "蜂房", "蟾酥"],
    "拔毒去腐生肌药": ["升药", "轻粉", "砒石", "炉甘石", "硼砂"]
};

// 名称映射（处理文档和数据库中的差异）
const nameMapping = {
    "紫苏叶": "紫苏",
    "棕榈炭": "棕榈",
    "木桶": "木通",
    "芥子": "白芥子",
    "硫磺": "硫黄",
    "臭梧桐叶": "臭梧桐",
    "糯稻根": "糯稻根须",
    "熊胆粉": "熊胆"
};

// 匹配函数
function matchMedicinesToCategories() {
    const newCategories = {};
    const notFound = [];
    
    for (const [category, names] of Object.entries(newCategoryStructure)) {
        newCategories[category] = [];
        
        for (const name of names) {
            // 应用名称映射
            const mappedName = nameMapping[name] || name;
            
            // 在数据库中查找
            const med = medicineDatabase.find(m => m.name === mappedName);
            
            if (med) {
                // 避免重复添加
                if (!newCategories[category].includes(med.id)) {
                    newCategories[category].push(med.id);
                }
            } else {
                notFound.push(`${name} (分类: ${category})`);
            }
        }
    }
    
    return { newCategories, notFound };
}

// 执行匹配
const { newCategories, notFound } = matchMedicinesToCategories();

console.log("=".repeat(60));
console.log("新的分类映射已生成！");
console.log("=".repeat(60));
console.log("\n未找到的中药:");
if (notFound.length > 0) {
    notFound.forEach(item => console.log(`  - ${item}`));
} else {
    console.log("  无（所有中药都已找到）");
}

console.log("\n" + "=".repeat(60));
console.log("复制以下内容替换 script.js 中的 medicineCategories:");
console.log("=".repeat(60));
console.log("\nconst medicineCategories = " + JSON.stringify(newCategories, null, 4) + ";");

// 输出统计信息
console.log("\n" + "=".repeat(60));
console.log("统计信息:");
console.log("=".repeat(60));
const totalMedicines = Object.values(newCategories).reduce((sum, ids) => sum + ids.length, 0);
console.log(`总分类数: ${Object.keys(newCategories).length}`);
console.log(`总中药数（去重后）: ${new Set(Object.values(newCategories).flat()).size}`);
console.log(`总中药数（含重复）: ${totalMedicines}`);
console.log(`未找到的中药数: ${notFound.length}`);

